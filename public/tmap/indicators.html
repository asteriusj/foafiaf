<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Tranfsform Rockford Regional Indicator Interactive Scorecard</title>
    <meta name="description" content="HTML 5 SVG Interactive Sunburst Diagram for Tranfsform Rockford Community Regional Indicator Scorecard">
    <meta name="author" content="Transform Rockford LLC | Asterius Media LLC">

    <link rel="stylesheet" href="assets/css/reset.css" />
    <style type="text/css"> 
      html, body {
        height: 100%;
      }
      #visualization {
        margin: 10px;
        padding: 5px;
        height: 100%;
      }
    </style>

    <script src="./carrotsearch.circles.js"></script>
    <script src="./carrotsearch.circles.asserts.js"></script>
    <script src="assets/js/carrotsearch.examples.onresizehook.js"></script>
    <script src="assets/js/carrotsearch.examples.viewport.js"></script>
  </head>

  <body>
    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
    "@type": "MobileApplication",
    "image": "http://transformrockford.org/wp-content/uploads/2014/05/trlogo300x300.png",
    "name": "Tranfsform Rockford Regional Indicator Interactive Scorecard",
    "author": {
      "@type": "Organization",
      "url": "https://github.com/asteriusj",
      "name": "asteriusj - Jeffrey Stewart"
    },
  "url": "http://foafiaf.transformrockford.org/tmap/indicators.html",
  "datePublished": "2018-08-08",
  "operatingSystem": "Web",
  "fileSize" : "0",
  "interactionCount" : "",
  "contentRating" : "",
  "description" : "HTML 5 SVG Interactive Sunburst Diagram for Tranfsform Rockford Community Regional Indicator Scorecard",
  "applicationCategory" : "Interactive Diagram"
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "NGO",
  "name": "Transform Rockford",
  "legalName": "Transform Rockford LLC",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "303 N Main, Suite 110",
    "addressLocality": "Rockford",
    "addressRegion": "Illinois",
    "postalCode": "61101"
  },
  "description": "TRANSFORMING OUR REGION FROM WITHIN - The Transform Rockford mission is to facilitate the creation and implementation of a strategic plan by the community for the purposes of dramatically improving the social and economic well-being of the community and its residents.",
  "telephone": "+1 815.977.5840",
  "logo": "http://transformrockford.org/wp-content/uploads/2014/05/trlogo300x300.png",
  "url": "http://transformrockford.org/"
}
</script>

    <div id="visualization"></div>

    <script>
      function embed() {
        // We respin until the visualization container has non-zero area (there are race 
        // conditions on Chrome which permit that) and the visualization class is loaded.
        var container = document.getElementById("visualization");
        if (container.clientWidth <= 0 || container.clientHeight <= 0 || !window["CarrotSearchCircles"]) {
          window.setTimeout(embed, 250);
          return;
        }

        // Use the defaults for all parameters.
        var circles = new CarrotSearchCircles({
          id: "visualization",
          captureMouseEvents: false,
          pixelRatio: Math.min(1.5, window.devicePixelRatio || 1),
          visibleGroupCount: 0,
          onBeforeSelection: function(info) { 
            this.set("zoom", {
              groups: [info.group.id],
              zoomed: !info.group.zoomed
            });
            return false;
          },
          onBeforeZoom: function(info) {
            this.set("selection", {
              groups:   [info.group.id],
              selected: !info.group.selected
            });
            return false;
          },
          onGroupClick: function(info) {
            console.log("Click.");
          }, 
          onGroupDoubleClick: function(info) {
            console.log("Dbl Click.");
          },
          
        //   dataObject: {}

        });
    
circles.set({dataObject: {groups: [
  {}, {label: "loading..." }, {},
  {}, {label: "Please wait" }, {}
]}});

fetch('./indicators.json')
    .then(function (response) {
        
      return response.json();
    })
    .then(function (data) {
        console.log(data);
      
        var groups = data.groups;
        
        var customAttributes = function(opts, params, vars) {
          console.log("Color decorator callback.", params, vars);
          vars.groupColor = params.group.gcolor;
          vars.labelColor = "auto";
        };
        
        circles.set({
          titleBar: "topbottom",
          titleBarBackgroundColor: "rgba(0,0,0,.2)",
          titleBarTextColor: "#fff",
          titleBarTextPaddingTopBottom: 10,
          
          // onGroupClick: function(info) {
          // // Zoom on single click.
          // console.log('info',info)
          // this.set("zoom", {
          //     groups: [info.group.id],
          //     zoomed: !info.group.zoomed
          //   });
          // },
        
          groupColorDecorator: customAttributes,
          dataObject: {
            groups
          }
        });
        
        
        // var _dataObject = {}
        // _dataObject.open =true
        // _dataObject.groups = groups
     
        // circles.set("dataObject", _dataObject);      
      
      
    });


// $.ajax({
//   url: "./census-raw.json",
//   dataType: "json",
//   success: function(data) {
//     var groups = [ ];
//     var states = data.groups;
//     var pow = 0.7;
//     for (var i = 0; i < states.length; i++) {
//       var s = states[i];
//       groups.push({
//         label: s.Placename,
//         weight: s.Pop,
//         groups: [
//           // Ethnic data is very varied, we rise it to the power of 0.8 to 
//           // make the differences less pronounced.
//           { label: "Hispanic", weight: Math.pow(s.PctHisp, pow) },
//           { label: "White",    weight: Math.pow(s.PctNonHispWhite, pow) },
//           { label: "Black",    weight: Math.pow(s.PctBlack, pow) },
//           { label: "Indian",   weight: Math.pow(s.PctAmInd, pow) },
//           { label: "Asian",    weight: Math.pow(s.PctAsian, pow) },
//           { label: "Hawaiian", weight: Math.pow(s.PctNatHawOth, pow) }
//         ]
//       })
//     }
 
//     circles.set("dataObject", { open: true, groups: groups });
//   }
// });


        installResizeHandlerFor(circles, 0);
      }
      embed();
    </script>
  </body>
</html>
